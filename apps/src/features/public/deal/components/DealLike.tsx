'use client';

import { useAuth } from '@/hooks/useAuth';
import { cn } from '@/lib/utils';
import { Button } from '@/shared/shadecn/ui/button';
import Cookies from 'js-cookie';
import { useRouter } from 'next/navigation';
import { memo, useCallback, useEffect, useState } from 'react';

interface Props {
    dealId: string;
    initialLikes: number;
    likedBy?: string[];
}

const ThumbsUpSvg = memo(() => (
    <svg
        width={22}
        height={22}
        className="w-4.5 h-4.5 md:w-5.5 md:h-5.5"
        viewBox="0 0 16 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
    >
        <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M7.01875 1.39276C6.96121 1.4453 6.94705 1.49486 6.94705 1.52572V3.12971C6.94823 3.87557 6.76568 4.61052 6.41531 5.26423C6.25079 5.5712 5.96527 5.813 5.76452 5.97303C5.66354 6.05353 5.57922 6.11749 5.50635 6.17276C5.3968 6.25585 5.31312 6.31932 5.23762 6.38986C5.1139 6.50544 5.02554 6.71165 5.02362 6.95711C5.02513 6.97417 5.0273 6.99891 5.03004 7.03065C5.03562 7.09536 5.04358 7.18924 5.0531 7.30665C5.07215 7.5414 5.09753 7.87063 5.12292 8.24914C5.17348 9.00287 5.22494 9.96473 5.22494 10.7664C5.22494 11.5436 5.19287 12.5371 5.10897 13.3953C5.10723 13.4224 5.10554 13.4484 5.10393 13.4731C5.10298 13.4876 5.10205 13.5018 5.10115 13.5154C5.0851 14.1679 5.51427 14.6369 6.05328 14.6632C7.02404 14.7106 8.36985 14.7099 9.74014 14.5349C11.1199 14.3587 12.4714 14.0122 13.4904 13.402C13.7 13.2765 13.9085 13.0021 14.0839 12.5152C14.2556 12.0385 14.3659 11.4402 14.4385 10.7859C14.5107 10.1356 14.5424 9.46143 14.5691 8.83755C14.5711 8.79093 14.5731 8.74443 14.575 8.6981C14.5986 8.14084 14.6211 7.60914 14.673 7.21569L14.6735 7.21202L14.674 7.20835C14.7047 6.99504 14.6909 6.77739 14.6337 6.57072C14.5766 6.36408 14.4779 6.17458 14.3459 6.01464C14.214 5.85478 14.0523 5.72848 13.8729 5.64264C13.7352 5.57675 13.5891 5.53564 13.4405 5.5201C13.4038 5.51626 13.3453 5.51939 13.2447 5.54184L9.95455 6.27593C9.41998 6.3952 8.91255 5.98851 8.91255 5.4408L8.91255 3.20651M8.91255 3.20651C8.91184 2.69621 8.71706 2.21146 8.37881 1.85843C8.16577 1.63608 8.0201 1.5144 7.86832 1.4379C7.72629 1.36631 7.53466 1.31271 7.20539 1.31271C7.15282 1.31271 7.07919 1.3376 7.01875 1.39276M3.85873 13.2946C3.85409 13.3441 3.85088 13.3936 3.8491 13.443C3.84451 13.5124 3.84065 13.5691 3.83779 13.6105C3.83728 13.6179 3.83681 13.6247 3.83637 13.6311C3.83527 13.6469 3.83437 13.6597 3.8337 13.6691L3.83069 13.7111L3.83067 13.7334C3.83054 13.8597 3.77245 14.0054 3.62105 14.1635C3.50999 14.2794 3.3653 14.3394 3.22029 14.3397L1.89375 14.3397C1.74873 14.3394 1.60351 14.2794 1.49246 14.1635C1.38417 14.0504 1.31751 13.8934 1.31297 13.7238C1.31387 13.7103 1.31509 13.6915 1.31662 13.6679C1.31996 13.6161 1.32472 13.5409 1.33043 13.4473C1.34185 13.26 1.35706 12.9983 1.37228 12.7002C1.40257 12.107 1.43346 11.3588 1.43346 10.7664C1.43346 10.1741 1.40257 9.42583 1.37228 8.83266C1.35706 8.53458 1.34185 8.27286 1.33043 8.08559C1.32472 7.99192 1.31996 7.91679 1.31662 7.86495C1.31509 7.84137 1.31387 7.8226 1.31297 7.80909C1.31751 7.63943 1.38417 7.48242 1.49246 7.3694C1.60357 7.25344 1.74835 7.19341 1.89344 7.19316L3.21976 7.19316C3.41953 7.19349 3.64821 7.28868 3.72556 7.3694C3.74163 7.38618 3.76061 7.41313 3.77605 7.48178C3.7939 7.56116 3.80061 7.6658 3.80078 7.82686L3.8008 7.85469L3.8033 7.88239L3.805 7.9016C3.80614 7.91458 3.80784 7.93393 3.81 7.95907C3.81432 8.00935 3.82053 8.08275 3.82799 8.17452C3.84291 8.35816 3.86282 8.61497 3.88271 8.90722C3.92278 9.49573 3.96176 10.2132 3.96176 10.7664C3.96176 11.3239 3.92981 12.0516 3.89715 12.6476C3.88355 12.8958 3.86995 13.119 3.85873 13.2946ZM3.95554 6.07554C4.05385 5.85556 4.19378 5.6488 4.38148 5.47344C4.50059 5.36217 4.67527 5.22875 4.82104 5.11741C4.88209 5.07078 4.93808 5.02802 4.98278 4.99238C5.18626 4.83018 5.27992 4.72784 5.30995 4.6718C5.5614 4.20265 5.69385 3.67205 5.69294 3.1313V1.52572C5.69294 0.657428 6.46955 0.0585941 7.20539 0.0585938C7.68102 0.0585935 8.07613 0.138231 8.4328 0.318005C8.77972 0.492866 9.04469 0.740665 9.28435 0.99079C9.85133 1.58254 10.1658 2.37937 10.1667 3.20519L10.1667 4.94366L12.9716 4.31782C13.1323 4.28197 13.3415 4.24878 13.571 4.2728C13.8629 4.30333 14.1478 4.38393 14.4141 4.51135C14.7611 4.67733 15.0674 4.91844 15.3133 5.21648C15.5591 5.51444 15.7391 5.86256 15.8425 6.23653C15.9455 6.60917 15.9705 7.00004 15.9159 7.38305C15.872 7.71811 15.8518 8.1936 15.8269 8.77858C15.8253 8.81565 15.8237 8.85317 15.8221 8.89111C15.7955 9.51328 15.7624 10.2265 15.685 10.9242C15.608 11.618 15.4841 12.3284 15.2638 12.9402C15.0471 13.5418 14.7059 14.1359 14.1347 14.4779C12.9016 15.2164 11.3535 15.5932 9.89898 15.7789C8.43502 15.9659 7.012 15.9656 5.99218 15.9159C5.32331 15.8832 4.78451 15.5818 4.41424 15.1389C4.08575 15.4287 3.66393 15.5933 3.22119 15.5938H1.89231C1.3973 15.5932 0.928422 15.3875 0.586916 15.0311C0.246279 14.6756 0.0591337 14.199 0.0586163 13.7073L0.0585938 13.6859L0.061336 13.6449C0.0622 13.6319 0.063476 13.6124 0.0651049 13.5872C0.0683632 13.5367 0.0730324 13.463 0.0786423 13.371C0.0898661 13.1868 0.104835 12.9293 0.119799 12.6363C0.149881 12.0471 0.179351 11.3252 0.179351 10.7664C0.179351 10.2076 0.149881 9.48576 0.119799 8.89661C0.104835 8.60353 0.0898661 8.34603 0.0786423 8.16188C0.0730324 8.06984 0.0683632 7.9962 0.0651049 7.9457C0.063476 7.92045 0.0622 7.90099 0.061336 7.88792L0.0585938 7.84701L0.0586163 7.82555C0.0591337 7.33382 0.246279 6.85728 0.586916 6.50177C0.928422 6.14534 1.3973 5.93962 1.89231 5.93905L3.22119 5.93905C3.44284 5.9393 3.70346 5.98263 3.95554 6.07554Z"
            fill="#E9F2FF"
        ></path>
        <path
            d="M3.85873 13.2946C3.85409 13.3441 3.85088 13.3936 3.8491 13.443C3.84451 13.5124 3.84065 13.5691 3.83779 13.6105L3.83637 13.6311L3.8337 13.6691L3.83069 13.7111L3.83067 13.7334C3.83054 13.8597 3.77245 14.0054 3.62105 14.1635C3.50999 14.2794 3.3653 14.3394 3.22029 14.3397L1.89375 14.3397C1.74873 14.3394 1.60351 14.2794 1.49246 14.1635C1.38417 14.0504 1.31751 13.8934 1.31297 13.7238L1.31662 13.6679C1.31996 13.6161 1.32472 13.5409 1.33043 13.4473C1.34185 13.26 1.35706 12.9983 1.37228 12.7002C1.40257 12.107 1.43346 11.3588 1.43346 10.7664C1.43346 10.1741 1.40257 9.42583 1.37228 8.83266C1.35706 8.53458 1.34185 8.27286 1.33043 8.08559C1.32472 7.99192 1.31996 7.91679 1.31662 7.86495L1.31297 7.80909C1.31751 7.63943 1.38417 7.48242 1.49246 7.3694C1.60357 7.25344 1.74835 7.19341 1.89344 7.19316L3.21976 7.19316C3.41953 7.19349 3.64821 7.28868 3.72556 7.3694C3.74163 7.38618 3.76061 7.41313 3.77605 7.48178C3.7939 7.56116 3.80061 7.6658 3.80078 7.82686L3.8008 7.85469L3.8033 7.88239L3.805 7.9016L3.81 7.95907C3.81432 8.00935 3.82053 8.08275 3.82799 8.17452C3.84291 8.35816 3.86282 8.61497 3.88271 8.90722C3.92278 9.49573 3.96176 10.2132 3.96176 10.7664C3.96176 11.3239 3.92981 12.0516 3.89715 12.6476C3.88355 12.8958 3.86995 13.119 3.85873 13.2946Z"
            fill="#E9F2FF"
        ></path>
        <path
            d="M7.01875 1.39276C6.96121 1.4453 6.94705 1.49486 6.94705 1.52572V3.12971C6.94823 3.87557 6.76568 4.61052 6.41531 5.26423C6.25079 5.5712 5.96527 5.813 5.76452 5.97303C5.66354 6.05353 5.57922 6.11749 5.50635 6.17276C5.3968 6.25585 5.31312 6.31932 5.23762 6.38986C5.1139 6.50544 5.02554 6.71165 5.02362 6.95711L5.03004 7.03065C5.03562 7.09536 5.04358 7.18924 5.0531 7.30665C5.07215 7.5414 5.09753 7.87063 5.12292 8.24914C5.17348 9.00287 5.22494 9.96473 5.22494 10.7664C5.22494 11.5436 5.19287 12.5371 5.10897 13.3953L5.10393 13.4731L5.10115 13.5154C5.0851 14.1679 5.51427 14.6369 6.05328 14.6632C7.02404 14.7106 8.36985 14.7099 9.74014 14.5349C11.1199 14.3587 12.4714 14.0122 13.4904 13.402C13.7 13.2765 13.9085 13.0021 14.0839 12.5152C14.2556 12.0385 14.3659 11.4402 14.4385 10.7859C14.5107 10.1356 14.5424 9.46143 14.5691 8.83755L14.575 8.6981C14.5986 8.14084 14.6211 7.60914 14.673 7.21569L14.6735 7.21202L14.674 7.20835C14.7047 6.99504 14.6909 6.77739 14.6337 6.57072C14.5766 6.36408 14.4779 6.17458 14.3459 6.01464C14.214 5.85478 14.0523 5.72848 13.8729 5.64264C13.7352 5.57675 13.5891 5.53564 13.4405 5.5201C13.4038 5.51626 13.3453 5.51939 13.2447 5.54184L9.95455 6.27593C9.41998 6.3952 8.91255 5.98851 8.91255 5.4408L8.91255 3.20651C8.91184 2.69621 8.71706 2.21146 8.37881 1.85843C8.16577 1.63608 8.0201 1.5144 7.86832 1.4379C7.72629 1.36631 7.53466 1.31271 7.20539 1.31271C7.15282 1.31271 7.07919 1.3376 7.01875 1.39276Z"
            fill="#E9F2FF"
        ></path>
        <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M7.01875 1.39276C6.96121 1.4453 6.94705 1.49486 6.94705 1.52572V3.12971C6.94823 3.87557 6.76568 4.61052 6.41531 5.26423C6.25079 5.5712 5.96527 5.813 5.76452 5.97303C5.66354 6.05353 5.57922 6.11749 5.50635 6.17276C5.3968 6.25585 5.31312 6.31932 5.23762 6.38986C5.1139 6.50544 5.02554 6.71165 5.02362 6.95711C5.02513 6.97417 5.0273 6.99891 5.03004 7.03065C5.03562 7.09536 5.04358 7.18924 5.0531 7.30665C5.07215 7.5414 5.09753 7.87063 5.12292 8.24914C5.17348 9.00287 5.22494 9.96473 5.22494 10.7664C5.22494 11.5436 5.19287 12.5371 5.10897 13.3953C5.10723 13.4224 5.10554 13.4484 5.10393 13.4731C5.10298 13.4876 5.10205 13.5018 5.10115 13.5154C5.0851 14.1679 5.51427 14.6369 6.05328 14.6632C7.02404 14.7106 8.36985 14.7099 9.74014 14.5349C11.1199 14.3587 12.4714 14.0122 13.4904 13.402C13.7 13.2765 13.9085 13.0021 14.0839 12.5152C14.2556 12.0385 14.3659 11.4402 14.4385 10.7859C14.5107 10.1356 14.5424 9.46143 14.5691 8.83755C14.5711 8.79093 14.5731 8.74443 14.575 8.6981C14.5986 8.14084 14.6211 7.60914 14.673 7.21569L14.6735 7.21202L14.674 7.20835C14.7047 6.99504 14.6909 6.77739 14.6337 6.57072C14.5766 6.36408 14.4779 6.17458 14.3459 6.01464C14.214 5.85478 14.0523 5.72848 13.8729 5.64264C13.7352 5.57675 13.5891 5.53564 13.4405 5.5201C13.4038 5.51626 13.3453 5.51939 13.2447 5.54184L9.95455 6.27593C9.41998 6.3952 8.91255 5.98851 8.91255 5.4408L8.91255 3.20651M8.91255 3.20651C8.91184 2.69621 8.71706 2.21146 8.37881 1.85843C8.16577 1.63608 8.0201 1.5144 7.86832 1.4379C7.72629 1.36631 7.53466 1.31271 7.20539 1.31271C7.15282 1.31271 7.07919 1.3376 7.01875 1.39276M3.85873 13.2946C3.85409 13.3441 3.85088 13.3936 3.8491 13.443C3.84451 13.5124 3.84065 13.5691 3.83779 13.6105C3.83728 13.6179 3.83681 13.6247 3.83637 13.6311C3.83527 13.6469 3.83437 13.6597 3.8337 13.6691L3.83069 13.7111L3.83067 13.7334C3.83054 13.8597 3.77245 14.0054 3.62105 14.1635C3.50999 14.2794 3.3653 14.3394 3.22029 14.3397L1.89375 14.3397C1.74873 14.3394 1.60351 14.2794 1.49246 14.1635C1.38417 14.0504 1.31751 13.8934 1.31297 13.7238C1.31387 13.7103 1.31509 13.6915 1.31662 13.6679C1.31996 13.6161 1.32472 13.5409 1.33043 13.4473C1.34185 13.26 1.35706 12.9983 1.37228 12.7002C1.40257 12.107 1.43346 11.3588 1.43346 10.7664C1.43346 10.1741 1.40257 9.42583 1.37228 8.83266C1.35706 8.53458 1.34185 8.27286 1.33043 8.08559C1.32472 7.99192 1.31996 7.91679 1.31662 7.86495C1.31509 7.84137 1.31387 7.8226 1.31297 7.80909C1.31751 7.63943 1.38417 7.48242 1.49246 7.3694C1.60357 7.25344 1.74835 7.19341 1.89344 7.19316L3.21976 7.19316C3.41953 7.19349 3.64821 7.28868 3.72556 7.3694C3.74163 7.38618 3.76061 7.41313 3.77605 7.48178C3.7939 7.56116 3.80061 7.6658 3.80078 7.82686L3.8008 7.85469L3.8033 7.88239L3.805 7.9016C3.80614 7.91458 3.80784 7.93393 3.81 7.95907C3.81432 8.00935 3.82053 8.08275 3.82799 8.17452C3.84291 8.35816 3.86282 8.61497 3.88271 8.90722C3.92278 9.49573 3.96176 10.2132 3.96176 10.7664C3.96176 11.3239 3.92981 12.0516 3.89715 12.6476C3.88355 12.8958 3.86995 13.119 3.85873 13.2946ZM3.95554 6.07554C4.05385 5.85556 4.19378 5.6488 4.38148 5.47344C4.50059 5.36217 4.67527 5.22875 4.82104 5.11741C4.88209 5.07078 4.93808 5.02802 4.98278 4.99238C5.18626 4.83018 5.27992 4.72784 5.30995 4.6718C5.5614 4.20265 5.69385 3.67205 5.69294 3.1313V1.52572C5.69294 0.657428 6.46955 0.0585941 7.20539 0.0585938C7.68102 0.0585935 8.07613 0.138231 8.4328 0.318005C8.77972 0.492866 9.04469 0.740665 9.28435 0.99079C9.85133 1.58254 10.1658 2.37937 10.1667 3.20519L10.1667 4.94366L12.9716 4.31782C13.1323 4.28197 13.3415 4.24878 13.571 4.2728C13.8629 4.30333 14.1478 4.38393 14.4141 4.51135C14.7611 4.67733 15.0674 4.91844 15.3133 5.21648C15.5591 5.51444 15.7391 5.86256 15.8425 6.23653C15.9455 6.60917 15.9705 7.00004 15.9159 7.38305C15.872 7.71811 15.8518 8.1936 15.8269 8.77858C15.8253 8.81565 15.8237 8.85317 15.8221 8.89111C15.7955 9.51328 15.7624 10.2265 15.685 10.9242C15.608 11.618 15.4841 12.3284 15.2638 12.9402C15.0471 13.5418 14.7059 14.1359 14.1347 14.4779C12.9016 15.2164 11.3535 15.5932 9.89898 15.7789C8.43502 15.9659 7.012 15.9656 5.99218 15.9159C5.32331 15.8832 4.78451 15.5818 4.41424 15.1389C4.08575 15.4287 3.66393 15.5933 3.22119 15.5938H1.89231C1.3973 15.5932 0.928422 15.3875 0.586916 15.0311C0.246279 14.6756 0.0591337 14.199 0.0586163 13.7073L0.0585938 13.6859L0.061336 13.6449C0.0622 13.6319 0.063476 13.6124 0.0651049 13.5872C0.0683632 13.5367 0.0730324 13.463 0.0786423 13.371C0.0898661 13.1868 0.104835 12.9293 0.119799 12.6363C0.149881 12.0471 0.179351 11.3252 0.179351 10.7664C0.179351 10.2076 0.149881 9.48576 0.119799 8.89661C0.104835 8.60353 0.0898661 8.34603 0.0786423 8.16188C0.0730324 8.06984 0.0683632 7.9962 0.0651049 7.9457C0.063476 7.92045 0.0622 7.90099 0.061336 7.88792L0.0585938 7.84701L0.0586163 7.82555C0.0591337 7.33382 0.246279 6.85728 0.586916 6.50177C0.928422 6.14534 1.3973 5.93962 1.89231 5.93905L3.22119 5.93905C3.44284 5.9393 3.70346 5.98263 3.95554 6.07554Z"
            fill="#146FF5"
        ></path>
    </svg>
));

const ThumbsUpFilledSvg = memo(() => (
    <svg
        width={22}
        height={22}
        className="w-4.5 h-4.5 md:w-5.5 md:h-5.5"
        viewBox="0 0 16 16"
        preserveAspectRatio="xMinYMin meet"
        role="img"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
    >
        <path
            id="Thumb (16px)"
            d="M15.9756 7.23055C15.7499 8.9421 16.0623 13.4716 14.3549 14.4942C11.892 15.9691 8.35595 16.0762 6.17918 15.97C5.08989 15.9169 4.3419 14.9275 4.4487 13.8421C4.53845 12.93 4.62104 11.8628 4.62104 11.0238C4.62104 9.31735 4.40099 6.88987 4.40099 6.88987C4.3957 6.46464 4.54175 6.02706 4.85251 5.73674C5.1748 5.43564 5.44849 5.07992 5.66124 4.68296C5.99034 4.06892 6.16258 3.37685 6.16139 2.67327V0.918649C6.16139 0.40533 6.64348 2.15468e-07 7.1296 0C8.0098 -3.90137e-07 8.41288 0.291418 8.90792 0.808085C9.40296 1.32475 9.68141 2.02527 9.68218 2.75595V5.19997C9.68218 5.35999 9.83043 5.47882 9.98662 5.44397L13.5846 4.6412C13.7274 4.60933 13.8738 4.58947 14.0194 4.6047C14.2602 4.62989 14.4958 4.69644 14.7167 4.80213C15.0045 4.93982 15.2605 5.14071 15.467 5.39108C15.6736 5.64145 15.826 5.9354 15.9138 6.25286C16.0015 6.57032 16.0226 6.90381 15.9756 7.23055ZM2.2005 6.43055H1.3203C0.97025 6.43095 0.634651 6.57625 0.387131 6.83459C0.13961 7.09292 0.000384417 7.44318 0 7.80852C0 7.80852 0.13203 9.76495 0.13203 11.0238C0.13203 12.2826 0 14.2391 0 14.2391C0.000384417 14.6044 0.13961 14.9547 0.387131 15.213C0.634651 15.4713 0.97025 15.6166 1.3203 15.617H2.2005C2.55054 15.6166 2.88614 15.4713 3.13366 15.213C3.38118 14.9547 3.52041 14.6044 3.52079 14.2391C3.52079 14.2391 3.69683 12.2826 3.69683 11.0238C3.69683 9.76495 3.52079 7.80852 3.52079 7.80852C3.52041 7.44318 3.38118 7.09292 3.13366 6.83459C2.88614 6.57625 2.55054 6.43095 2.2005 6.43055Z"
            fill="inherit"
        ></path>
    </svg>
));

const getGuestLikes = (): string[] => {
    if (typeof window === 'undefined') return [];
    try {
        return JSON.parse(localStorage.getItem('guest_liked_deals') || '[]');
    } catch {
        return [];
    }
};

const setGuestLikes = (likes: string[]) => {
    localStorage.setItem('guest_liked_deals', JSON.stringify(likes));
};

export default function DealLike({ dealId, initialLikes, likedBy = [] }: Props) {
    const router = useRouter();

    const [likes, setLikes] = useState(initialLikes);
    const [liked, setLiked] = useState(false);
    const [loading, setLoading] = useState(false);
    const [guestLikes, setGuestLikesState] = useState<string[]>([]);

    const { user, isSignin } = useAuth();

    useEffect(() => {
        if (!isSignin) {
            setGuestLikesState(getGuestLikes());
        }
    }, [isSignin]);

    useEffect(() => {
        if (isSignin) {
            setLiked(likedBy.includes(user?._id ?? ''));
        } else {
            setLiked(guestLikes.includes(dealId));
        }

        setLikes(initialLikes);
    }, [initialLikes, likedBy, isSignin, user?._id, dealId, guestLikes]);

    const handleLike = useCallback(async () => {
        if (loading) return;
        if (!isSignin && liked) return;

        try {
            setLoading(true);

            // optimistic
            setLiked(true);
            setLikes((prev) => prev + 1);

            const res = await fetch(`/api/common/deal/${dealId}/like`, {
                method: 'POST',
                headers: isSignin
                    ? {
                          'Content-Type': 'application/json',
                          Authorization: `Bearer ${Cookies.get('token')}`,
                      }
                    : undefined,
                body: isSignin ? JSON.stringify({ userId: user?._id }) : undefined,
            });

            if (res.status === 401) {
                router.push('/signin');
                return;
            }

            const data = await res.json();

            if (!data.success) {
                setLiked(false);
                setLikes((prev) => prev - 1);
                return;
            }

            if (!isSignin) {
                const next = [...guestLikes, dealId];
                setGuestLikes(next);
                setGuestLikesState(next);
            } else {
                setLiked(data.liked);
                setLikes(data.likes);
            }
        } catch {
            setLiked(false);
            setLikes((prev) => prev - 1);
        } finally {
            setLoading(false);
        }
    }, [loading, liked, isSignin, dealId, user?._id, guestLikes, router]);

    return (
        <Button
            variant="ghost"
            size="sm"
            onClick={handleLike}
            disabled={loading}
            className={cn(
                'flex items-center gap-2 transition-all duration-200 h-9 px-3 hover:bg-transparent text-blue-600',
                liked && !isSignin ? 'cursor-not-allowed' : 'hover:opacity-80',
            )}
        >
            {liked ? <ThumbsUpFilledSvg /> : <ThumbsUpSvg />}
            <span className="font-medium text-[13px] md:text-sm">{likes}</span>
        </Button>
    );
}
